map_compressed = [ 
	[ [ 7,3 ],[ 4,1 ],[ 1,2 ],[ 4,1 ],[ 7,153 ] ],
	[ [ 7,3 ],[ 3,1 ],[ 1,2 ],[ 5,1 ],[ 7,153 ] ],
	[ [ 7,3 ],[ 4,1 ],[ 1,2 ],[ 4,1 ],[ 7,153 ] ],
	[ [ 7,3 ],[ 3,1 ],[ 1,2 ],[ 5,1 ],[ 7,153 ] ],
	[ [ 7,3 ],[ 5,1 ],[ 1,2 ],[ 4,1 ],[ 7,107 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,2 ],[ 3,2 ],[ 5,1 ],[ 3,2 ],[ 5,2 ],[ 3,1 ],[ 4,1 ],[ 5,3 ],[ 3,2 ],[ 5,1 ],[ 3,2 ],[ 5,2 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 5,2 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 7,9 ] ],
	[ [ 7,3 ],[ 5,1 ],[ 1,2 ],[ 3,1 ],[ 7,100 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 3,1 ],[ 9,17 ],[ 5,1 ],[ 9,17 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 4,2 ],[ 5,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 3,1 ],[ 1,2 ],[ 3,1 ],[ 7,100 ],[ 4,1 ],[ 1,7 ],[ 9,35 ],[ 1,7 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 4,1 ],[ 1,2 ],[ 4,1 ],[ 7,100 ],[ 5,1 ],[ 1,7 ],[ 9,35 ],[ 1,7 ],[ 3,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 3,1 ],[ 1,2 ],[ 5,1 ],[ 7,100 ],[ 3,1 ],[ 1,7 ],[ 9,35 ],[ 1,7 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 5,1 ],[ 1,2 ],[ 4,1 ],[ 7,100 ],[ 3,1 ],[ 1,1 ],[ 6,1 ],[ 1,2 ],[ 5,3 ],[ 9,35 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 1,2 ],[ 6,1 ],[ 1,1 ],[ 5,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 5,1 ],[ 1,2 ],[ 3,1 ],[ 7,40 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 3,2 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 7,44 ],[ 4,1 ],[ 1,3 ],[ 3,1 ],[ 4,3 ],[ 3,1 ],[ 4,1 ],[ 9,2 ],[ 5,1 ],[ 4,1 ],[ 9,2 ],[ 4,1 ],[ 3,1 ],[ 9,2 ],[ 4,2 ],[ 9,7 ],[ 4,1 ],[ 3,1 ],[ 9,2 ],[ 5,1 ],[ 4,1 ],[ 9,2 ],[ 5,1 ],[ 3,1 ],[ 9,2 ],[ 5,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 5,1 ],[ 1,3 ],[ 3,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 3,1 ],[ 1,2 ],[ 3,1 ],[ 7,40 ],[ 5,1 ],[ 9,14 ],[ 4,1 ],[ 7,44 ],[ 5,1 ],[ 1,2 ],[ 4,1 ],[ 3,2 ],[ 5,2 ],[ 1,35 ],[ 5,2 ],[ 3,1 ],[ 4,2 ],[ 1,2 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 5,1 ],[ 1,2 ],[ 4,1 ],[ 7,40 ],[ 3,1 ],[ 1,14 ],[ 3,1 ],[ 7,44 ],[ 3,1 ],[ 1,5 ],[ 5,1 ],[ 3,1 ],[ 1,35 ],[ 5,1 ],[ 4,1 ],[ 1,5 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 4,1 ],[ 1,2 ],[ 5,1 ],[ 7,40 ],[ 5,1 ],[ 1,2 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,2 ],[ 5,1 ],[ 1,2 ],[ 5,1 ],[ 7,44 ],[ 5,1 ],[ 1,5 ],[ 4,1],[ 3,1 ],[ 1,13 ],[ 2,2 ],[ 1,5 ],[ 2,2 ],[ 1,13 ],[ 4,1 ],[ 5,1 ],[ 1,5 ],[ 5,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 3,1 ],[ 1,2 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 3,2 ],[ 5,3 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 3,1 ],[ 1,2 ],[ 4,1 ],[ 7,8 ],[ 4,1 ],[ 1,2 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 3,1 ],[ 5,2 ],[ 3,1 ],[ 5,1 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 4,1 ],[ 7,23 ],[ 3,2 ],[ 1,2 ],[ 6,1 ],[ 1,1 ],[ 3,1 ],[ 5,1 ],[ 1,7 ],[ 2,2 ],[ 1,4 ],[ 11,2 ],[ 1,5 ],[ 11,2 ],[ 1,4 ],[ 2,2 ],[ 1,7 ],[ 5,1 ],[ 3,1 ],[ 1,1 ],[ 6,1 ],[ 1,2 ],[ 4,2 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 5,1 ],[ 1,2 ],[ 9,42 ],[ 1,2 ],[ 5,1 ],[ 7,8 ],[ 3,1 ],[ 1,2 ],[ 9,21 ],[ 5,1 ],[ 7,23 ],[ 5,2 ],[ 4,1 ],[ 1,3 ],[ 5,2 ],[ 1,7 ],[ 11,2 ],[ 1,4 ],[ 11,2 ],[ 1,5 ],[ 11,2 ],[ 1,4 ],[ 11,2 ],[ 1,7 ],[ 3,1 ],[4,1 ],[ 1,3 ],[ 4,1 ],[ 5,2 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 4,1 ],[ 1,46 ],[ 4,1 ],[ 7,8 ],[ 5,1 ],[ 1,23 ],[ 4,1 ],[ 7,23 ],[ 3,1 ],[ 4,1 ],[ 3,2 ],[ 1,2 ],[ 4,1 ],[ 5,1 ],[ 1,7 ],[ 11,2 ],[ 1,4 ],[ 5,1 ],[ 3,1 ],[ 1,5 ],[ 3,1 ],[ 5,1 ],[ 1,4 ],[ 11,2 ],[ 1,7 ],[ 5,1 ],[ 3,1 ],[ 1,2 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,3 ],[ 5,2 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 3,2 ],[ 5,2 ],[ 3,2 ],[ 5,1 ],[ 3,2 ],[ 5,2 ],[ 3,1 ],[ 4,1 ],[ 5,3 ],[ 3,2 ],[ 5,1 ],[ 3,2 ],[ 5,2 ],[ 3,1 ],[ 4,1 ],[ 5,3 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 4,1 ],[ 5,2 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 7,8 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 4,1 ],[ 5,2 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 5,1 ],[ 1,2 ],[ 3,1 ],[ 7,23 ],[ 4,1 ],[ 1,5 ],[ 4,1 ],[ 3,1 ],[ 1,3 ],[ 2,2 ],[ 1,2 ],[ 5,1 ],[ 4,1 ],[ 1,4 ],[ 9,2 ],[ 1,5 ],[ 9,2 ],[ 1,4 ],[ 5,1 ],[ 4,1 ],[ 1,2 ],[ 2,2 ],[ 1,3 ],[ 5,2 ],[ 1,5 ],[ 5,1 ],[ 7,2 ] ],
	[ [ 7,80 ],[ 3,1 ],[ 1,2 ],[ 4,1 ],[ 7,23],[ 5,1 ],[ 1,5 ],[ 5,1 ],[ 4,1 ],[ 1,3 ],[ 11,2 ],[ 1,2 ],[ 9,2 ],[ 1,17 ],[ 9,2 ],[ 1,2 ],[ 11,2 ],[ 1,3 ],[ 3,1 ],[ 5,1 ],[ 1,5 ],[ 5,1 ],[ 7,2 ] ],
	[ [ 7,80 ],[ 4,1 ],[ 1,2 ],[ 5,1 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 5,2 ],[ 7,15 ],[ 3,1 ],[ 1,1 ],[ 6,1 ],[ 1,2 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 1,3 ],[ 11,2 ],[ 1,25 ],[ 11,2 ],[ 1,3 ],[ 5,2 ],[ 3,1 ],[ 1,2 ],[ 6,1 ],[ 1,1 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,80 ],[ 3,1 ],[ 1,2 ],[ 9,8 ],[ 3,1 ],[ 7,15 ],[ 5,1 ],[ 1,3 ],[ 3,3 ],[ 4,1 ],[ 1,3 ],[ 4,1 ],[ 3,1 ],[ 1,25 ],[ 5,2 ],[ 1,3 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 1,3 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,80 ],[ 4,1 ],[ 1,10 ],[ 3,1 ],[ 7,15 ],[ 3,1 ],[ 1,2 ],[ 4,2 ],[ 5,3 ],[ 1,3 ],[ 9,2 ],[ 1,25 ],[ 9,2 ],[ 1,3 ],[ 3,3 ],[ 4,1 ],[ 3,1 ],[ 1,2 ],[ 5,1 ],[ 7,2 ] ],
	[ [ 7,80 ],[ 5,2 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 1,2 ],[ 4,1 ],[ 7,15 ],[ 3,1 ],[ 1,2 ],[ 9,3 ],[ 5,1 ],[ 3,1 ],[ 1,35 ],[ 3,1 ],[ 5,1 ],[ 9,3 ],[ 1,2 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,88 ],[ 5,1 ],[ 1,2 ],[ 4,1 ],[ 7,15 ],[ 5,1 ],[ 1,5],[ 5,1 ],[ 4,1 ],[ 1,35 ],[ 5,2 ],[ 1,5 ],[ 5,1 ],[ 7,2 ] ],
	[ [ 7,88 ],[ 3,1 ],[ 1,2 ],[ 5,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 1,4 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 1,31 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 1,4 ],[ 5,1 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,88 ],[ 3,1 ],[ 1,2 ],[ 9,18 ],[ 1,4 ],[ 9,4 ],[ 1,31 ],[ 9,4 ],[ 1,3 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 7,2 ] ],
	[ [ 7,88 ],[ 5,1 ],[ 1,65 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 7,2 ] ],
	[ [ 7,88 ],[ 5,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 5,1 ],[ 3,1 ],[ 5,1 ],[ 3,2 ],[ 5,2 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 5,2 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 5,1 ],[ 3,2 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 5,1 ],[ 4,1 ],[ 3,1 ],[ 4,1 ],[ 3,1 ],[ 5,2 ],[ 4,1 ],[ 5,2 ],[ 3,1 ],[ 4,1 ],[ 5,2 ],[ 3,1 ],[ 4,1 ],[ 5,2 ],[ 3,1 ],[ 5,2 ],[ 3,1 ],[ 4,1 ],[ 5,2 ],[ 7,2 ] ],
	[ [ 7,160 ] ],[ [ 7,160 ] ],
];

fires = [
	[109,9],
	[111,14],
	[109,19],
	[155,9],
	[153,14],
	[155,19]
];

for(var i=0; i<array_length(fires); i+=1)
{
	instance_create_depth((fires[i, 0]*32)+16, (fires[i, 1]*32)+15, -5, oFire);
}

width = 0;

for (var i = 0; i < array_length(map_compressed[0]); i += 1) {
    width += map_compressed[0][i][1];
}

height = array_length(map_compressed);

tilesurface = surface_create(width*32, height*32);

surface_set_target(tilesurface);

for (var i = 0; i < array_length(map_compressed); i += 1) {
    var compressed_row = map_compressed[i];
    var ii = 0; // Horizontal position in the map
    for (var j = 0; j < array_length(compressed_row); j += 1) {
        var tileindex = compressed_row[j][0];
        var count = compressed_row[j][1];
        
        // Check if the tile index requires drawing (tiles not covered by ground objects)
        if tileindex < 3 || tileindex > 5 {
            // Draw the tiles for the run length
            for (var k = 0; k < count; k += 1) {
                var x_pos = (ii + k) * 32;
                var y_pos = i * 32;
                
                // Calculate left and top
                var left = (tileindex mod 3) * 32; // 3 tiles per row, each 32 pixels wide
                var top = (tileindex div 3) * 32;  // Move down a row every 3 tiles
                
                // Draw the specific 32x32 part of the sprite
                draw_sprite_part(TileSheet, 0, left, top, 32, 32, x_pos, y_pos);
            }
        }
		else
		{
			// Create ground objects for the run length
            for (var k = 0; k < count; k += 1) {
                var x_pos = (ii + k) * 32;
                var y_pos = i * 32;
                var newground = instance_create_layer(x_pos, y_pos, "Instances", oGround);
                newground.image_index = tileindex - 3;
            }
		}
        // Move the horizontal position forward by the count
        ii += count;
    }
}

loaded = true;

surface_reset_target();

global.gameOver=false;
global.gameOverTimer=0;
ending = undefined;